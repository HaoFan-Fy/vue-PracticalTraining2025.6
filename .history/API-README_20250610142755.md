# JSON Server API ä½¿ç”¨è¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨ JSON Server æ¥æ¨¡æ‹Ÿåç«¯ APIï¼ŒåŸºäº `web_front_schema.sql` ä¸­çš„æ•°æ®åº“ç»“æ„å’Œæ•°æ®ç”Ÿæˆã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨ JSON Server

```bash
# æ–¹å¼1: ä½¿ç”¨è‡ªå®šä¹‰å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
npm run json-server

# æ–¹å¼2: ä½¿ç”¨åŸºç¡€ json-server
npm run api

# æ–¹å¼3: åŒæ—¶å¯åŠ¨å‰ç«¯å’ŒAPIæœåŠ¡
npm run dev:full
```

### æœåŠ¡ä¿¡æ¯

- **API æœåŠ¡åœ°å€**: http://localhost:3000
- **æ•°æ®åº“æ–‡ä»¶**: `db.json`
- **é…ç½®æ–‡ä»¶**: `json-server.json`

## ğŸ“Š æ•°æ®è¡¨ç»“æ„

### ä¸»è¦æ•°æ®è¡¨

| è¡¨å | è¯´æ˜ | API ç«¯ç‚¹ |
|------|------|----------|
| sys_user | ç”¨æˆ·è¡¨ | `/sys_user` æˆ– `/api/system/user` |
| sys_role | è§’è‰²è¡¨ | `/sys_role` æˆ– `/api/system/role` |
| sys_menu | èœå•è¡¨ | `/sys_menu` æˆ– `/api/system/menu` |
| sys_dept | éƒ¨é—¨è¡¨ | `/sys_dept` æˆ– `/api/system/dept` |
| sys_user_role | ç”¨æˆ·è§’è‰²å…³è”è¡¨ | `/sys_user_role` æˆ– `/api/system/user-role` |
| sys_role_menu | è§’è‰²èœå•å…³è”è¡¨ | `/sys_role_menu` æˆ– `/api/system/role-menu` |
| sys_role_dept | è§’è‰²éƒ¨é—¨å…³è”è¡¨ | `/sys_role_dept` æˆ– `/api/system/role-dept` |

## ğŸ”— API ç«¯ç‚¹

### åŸºç¡€ CRUD æ“ä½œ

```bash
# è·å–æ‰€æœ‰ç”¨æˆ·
GET http://localhost:3000/sys_user
GET http://localhost:3000/api/system/user

# è·å–å•ä¸ªç”¨æˆ·
GET http://localhost:3000/sys_user/1

# åˆ›å»ºç”¨æˆ·
POST http://localhost:3000/sys_user
Content-Type: application/json

{
  "user_name": "newuser",
  "password": "password123",
  "email": "newuser@example.com",
  "dept_id": 103
}

# æ›´æ–°ç”¨æˆ·
PUT http://localhost:3000/sys_user/1
Content-Type: application/json

{
  "user_name": "updateduser",
  "email": "updated@example.com"
}

# åˆ é™¤ç”¨æˆ·
DELETE http://localhost:3000/sys_user/1
```

### æŸ¥è¯¢å‚æ•°

```bash
# åˆ†é¡µæŸ¥è¯¢
GET http://localhost:3000/sys_user?_page=1&_limit=10

# æ’åº
GET http://localhost:3000/sys_user?_sort=user_id&_order=desc

# è¿‡æ»¤
GET http://localhost:3000/sys_user?status=0
GET http://localhost:3000/sys_user?dept_id=103

# æ¨¡ç³ŠæŸ¥è¯¢
GET http://localhost:3000/sys_user?user_name_like=admin

# å…³è”æŸ¥è¯¢ï¼ˆå±•å¼€å…³è”æ•°æ®ï¼‰
GET http://localhost:3000/sys_user?_expand=dept
```

### è‡ªå®šä¹‰è®¤è¯æ¥å£

```bash
# ç”¨æˆ·ç™»å½•
POST http://localhost:3000/api/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

# è·å–ç”¨æˆ·ä¿¡æ¯
GET http://localhost:3000/api/user/info
Authorization: Bearer mock-jwt-token-admin
```

## ğŸ‘¤ æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | è¯´æ˜ |
|--------|------|------|------|
| admin | admin123 | ç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| user | user123 | æ™®é€šç”¨æˆ· | åŸºç¡€æƒé™ |

## ğŸ“ æ•°æ®ç¤ºä¾‹

### ç”¨æˆ·æ•°æ®ç»“æ„

```json
{
  "user_id": 1,
  "user_name": "admin",
  "password": "$2a$10$7JB720yubVSZvUI0rEqK/.VqGOZTH.ulu33dHOiBE8ByOhJIrdAu2",
  "email": "user1@example.com",
  "phonenumber": "1234567890",
  "dept_id": 103,
  "status": "0",
  "create_time": "2024-11-05 20:46:11",
  "nick_name": "ç®¡ç†å‘˜"
}
```

### è§’è‰²æ•°æ®ç»“æ„

```json
{
  "role_id": 1,
  "role_name": "è¶…çº§ç®¡ç†å‘˜",
  "role_key": "admin",
  "role_sort": 1,
  "status": "0",
  "create_time": "2024-11-05 20:46:11",
  "remark": "è¶…çº§ç®¡ç†å‘˜"
}
```

### éƒ¨é—¨æ•°æ®ç»“æ„

```json
{
  "dept_id": 100,
  "parent_id": 0,
  "dept_name": "å¸è±ªå¨±ä¹",
  "order_num": 0,
  "leader": "é˜¿é‡Œå…‹è°¢.é©¬å…‹è¥¿è«ç»´å¥‡",
  "phone": "15888888888",
  "email": "ry@qq.com",
  "status": "0"
}
```

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### å…³è”æŸ¥è¯¢ç¤ºä¾‹

```bash
# è·å–ç”¨æˆ·åŠå…¶è§’è‰²ä¿¡æ¯
GET http://localhost:3000/sys_user/1?_embed=sys_user_role

# è·å–è§’è‰²åŠå…¶èœå•æƒé™
GET http://localhost:3000/sys_role/1?_embed=sys_role_menu

# è·å–éƒ¨é—¨åŠå…¶å­éƒ¨é—¨
GET http://localhost:3000/sys_dept?parent_id=100
```

### è‡ªå®šä¹‰ä¸­é—´ä»¶

å¦‚éœ€æ·»åŠ æ›´å¤šè‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥ä¿®æ”¹ `start-json-server.js` æ–‡ä»¶ï¼š

```javascript
// æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶
server.use((req, res, next) => {
  // åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
  console.log('è¯·æ±‚:', req.method, req.url)
  next()
})
```

## ğŸ”§ é…ç½®è¯´æ˜

### json-server.json é…ç½®

```json
{
  "port": 3000,
  "watch": true,
  "static": "./public",
  "delay": 0,
  "routes": {
    "/api/*": "/$1"
  }
}
```

### è·¯ç”±é‡å†™

åœ¨ `start-json-server.js` ä¸­é…ç½®äº†ä»¥ä¸‹è·¯ç”±é‡å†™ï¼š

- `/api/system/user` â†’ `/sys_user`
- `/api/system/role` â†’ `/sys_role`
- `/api/system/menu` â†’ `/sys_menu`
- `/api/system/dept` â†’ `/sys_dept`

## ğŸ“š æ›´å¤šèµ„æº

- [JSON Server å®˜æ–¹æ–‡æ¡£](https://github.com/typicode/json-server)
- [JSON Server æŸ¥è¯¢è¯­æ³•](https://github.com/typicode/json-server#routes)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„åç«¯æœåŠ¡ï¼Œä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•
2. æ•°æ®å­˜å‚¨åœ¨ `db.json` æ–‡ä»¶ä¸­ï¼Œé‡å¯æœåŠ¡ä¸ä¼šä¸¢å¤±æ•°æ®
3. å¯†ç å­—æ®µä½¿ç”¨äº† bcrypt åŠ å¯†ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦ç›¸åº”çš„è§£å¯†é€»è¾‘
4. ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨çœŸå®çš„åç«¯æœåŠ¡

## ğŸ¤ è´¡çŒ®

å¦‚éœ€æ·»åŠ æ›´å¤š API ç«¯ç‚¹æˆ–ä¿®æ”¹æ•°æ®ç»“æ„ï¼Œè¯·ï¼š

1. ä¿®æ”¹ `db.json` æ–‡ä»¶æ·»åŠ /ä¿®æ”¹æ•°æ®
2. åœ¨ `start-json-server.js` ä¸­æ·»åŠ è‡ªå®šä¹‰è·¯ç”±
3. æ›´æ–°æœ¬æ–‡æ¡£è¯´æ˜